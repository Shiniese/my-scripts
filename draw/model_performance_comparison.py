"""
========================================================================
è‡ªå®šä¹‰æ¨¡å‹æ€§èƒ½å¯¹æ¯”å¯è§†åŒ–è„šæœ¬ï¼ˆå•æ–‡ä»¶æ‰§è¡Œï¼‰
========================================================================

åŠŸèƒ½è¯´æ˜ï¼š
    æœ¬è„šæœ¬ç”¨äºå°†å¤šä¸ªæœºå™¨å­¦ä¹ æ¨¡å‹åœ¨ä¸åŒæ•°æ®é›†ï¼ˆè®­ç»ƒ/äº¤å‰éªŒè¯/æµ‹è¯•ï¼‰ä¸Šçš„æ€§èƒ½æŒ‡æ ‡ï¼ˆRMSEã€MAEã€R2ï¼‰è¿›è¡Œå¯è§†åŒ–ï¼Œ
    é€šè¿‡åˆ†é¢æŸ±çŠ¶å›¾å±•ç¤ºå„æ¨¡å‹åœ¨ä¸åŒæŒ‡æ ‡ä¸Šçš„è¡¨ç°å·®å¼‚ï¼Œæ”¯æŒç›´æ¥è¿è¡Œå¹¶ä¿å­˜å›¾è¡¨ã€‚
ğŸ“Œ ä½¿ç”¨åœºæ™¯ï¼š
    - æ¨¡å‹é€‰æ‹©ä¸æ¯”è¾ƒ
    - æœºå™¨å­¦ä¹ å®éªŒç»“æœå±•ç¤º
    - é¡¹ç›®æŠ¥å‘Šä¸­çš„å›¾è¡¨ç”Ÿæˆ
ğŸ“Œ ä¾èµ–åº“ï¼š
    - pandasï¼šæ•°æ®å¤„ç†
    - seabornï¼šå¯è§†åŒ–
    - matplotlibï¼šç»˜å›¾æ”¯æŒ
ğŸ“Œ è„šæœ¬ç»“æ„ï¼š
    1. å®šä¹‰æ¨¡å‹æ€§èƒ½æ•°æ®ï¼ˆå­—å…¸æ ¼å¼ï¼‰
    2. æ•°æ®æ¸…æ´—ä¸æ ¼å¼è½¬æ¢ï¼ˆå®½è¡¨ â†’ é•¿è¡¨ï¼‰
    3. è®¾ç½®ç»˜å›¾é£æ ¼ï¼ˆå­—ä½“ã€é…è‰²ç­‰ï¼‰
    4. ç”Ÿæˆåˆ†é¢æŸ±çŠ¶å›¾ï¼ˆæŒ‰æŒ‡æ ‡åˆ†åˆ—ï¼ŒæŒ‰æ•°æ®é›†ä¸Šè‰²ï¼‰
    5. æ·»åŠ æ•°å€¼æ ‡ç­¾ã€æ ‡é¢˜ã€è°ƒæ•´å¸ƒå±€å¹¶ä¿å­˜å›¾åƒ
ğŸ“Œ è¾“å‡ºï¼š
    - ä¸€å¼ åä¸º 'model_performance_comparison.png' çš„é«˜æ¸…å›¾åƒæ–‡ä»¶ï¼ˆ300 dpiï¼‰
    - å›¾è¡¨åœ¨å±å¹•ä¸Šæ˜¾ç¤ºï¼ˆéœ€æœ‰ GUI ç¯å¢ƒï¼‰
ğŸ“Œ æ³¨æ„äº‹é¡¹ï¼š
    - è¯·ç¡®ä¿å®‰è£…äº†å¿…è¦çš„åº“ï¼špip install pandas seaborn matplotlib
    - æ•°æ®ç»“æ„éœ€ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¼šå‡ºé”™
    - æ¨¡å‹åç§°ã€æŒ‡æ ‡åç§°ã€æ•°æ®é›†åç§°éœ€å‡†ç¡®æ— è¯¯
    - æ‰€æœ‰æ•°å€¼ä¿ç•™ä¸‰ä½å°æ•°ï¼Œç¡®ä¿å¯è¯»æ€§
ğŸ“Œ ç¤ºä¾‹æ•°æ®æ¥æºï¼š
    - XGBoost, RandomForest, LightGBM, CatBoost å››ç§æ¨¡å‹åœ¨ CVã€Trainã€Test ä¸Šçš„ RMSE/MAE/R2
    - æ•°æ®æ¥æºäºå®é™…æ¨¡å‹è®­ç»ƒå®éªŒç»“æœ
ğŸ“ ä¿®æ”¹å»ºè®®ï¼š
    ç”¨æˆ·å¯æ ¹æ®å®é™…éœ€æ±‚ä¿®æ”¹ data å­—å…¸ä¸­çš„å†…å®¹ï¼ˆå¦‚æ¨¡å‹åã€æŒ‡æ ‡å€¼ç­‰ï¼‰ã€‚
"""

# === è‡ªå·±éœ€è¦ä¿®æ”¹çš„å˜é‡ ===
# 1. å‡†å¤‡æ•°æ®
# å°†ä½ æä¾›çš„æ•°æ®æ•´ç†æˆå­—å…¸æ ¼å¼
data = {
    'Model': ['XGBoost', 'RandomForest', 'LightGBM', 'CatBoost'],
    'CV RMSE': [0.7296, 0.7365, 0.7392, 0.7504],
    'CV MAE': [0.4876, 0.5450, 0.5287, 0.5490],
    'CV RÂ²': [0.4349, 0.4292, 0.4240, 0.4063],
    'Train RMSE': [0.0205, 0.2611, 0.2228, 0.3109],
    'Train MAE': [0.0076, 0.1901, 0.1502, 0.2348],
    'Train RÂ²': [0.9996, 0.9295, 0.9486, 0.9000],
    'Test RMSE': [0.7953, 0.7771, 0.7708, 0.7761],
    'Test MAE': [0.5293, 0.5548, 0.5300, 0.5442],
    'Test RÂ²': [0.4231, 0.4492, 0.4581, 0.4506]
}

# å®šä¹‰æ¯ä¸ªæŒ‡æ ‡çš„ Y è½´ä¸Šé™ï¼ˆä¾‹å¦‚ï¼šRMSE=1.0, MAE=0.5, R2=1.0ï¼‰
y_limits = {
    'RMSE': 0.8,
    'MAE': 0.6,
    'R2': 1.0
}

# === è‡ªå·±éœ€è¦ä¿®æ”¹çš„å˜é‡ ===

import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt


df = pd.DataFrame(data)

# 2. æ•°æ®æ¸…æ´—ä¸è½¬æ¢ (Melt)
# å°†å®½æ ¼å¼è½¬æ¢ä¸ºé•¿æ ¼å¼ï¼Œæ–¹ä¾¿ Seaborn ç»˜å›¾
df_melted = df.melt(id_vars='Model', var_name='Metric_Type', value_name='Value')

# æ‹†åˆ† 'Metric_Type' (ä¾‹å¦‚ 'CV RMSE') ä¸º 'Dataset' (CV) å’Œ 'Metric' (RMSE)
df_melted[['Dataset', 'Metric']] = df_melted['Metric_Type'].str.split(' ', n=1, expand=True)

# 3. è®¾ç½®ç»˜å›¾é£æ ¼
sns.set_theme(style="whitegrid", font_scale=1.1)
# è®¾ç½®é»˜è®¤å­—ä½“
plt.rcParams['font.family'] = 'Times New Roman'

# 4. åˆ›å»ºåˆ†é¢æŸ±çŠ¶å›¾
# col='Metric': æŒ‰ç…§æŒ‡æ ‡åˆ†åˆ— (RMSE, MAE, R2)
# hue='Dataset': æŒ‰ç…§æ•°æ®é›†åˆ†ç»„é¢œè‰² (CV, Train, Test)
g = sns.catplot(
    data=df_melted,
    x='Model', 
    y='Value', 
    hue='Dataset', 
    col='Metric', 
    kind='bar',
    palette='muted',  # ä½¿ç”¨æŸ”å’Œçš„é…è‰²
    height=5, 
    aspect=1,
    sharey=False      # é‡è¦ï¼šå› ä¸ºR2å’ŒRMSE/MAEçš„æ•°å€¼èŒƒå›´ä¸åŒï¼Œä¸å…±äº«Yè½´
)

# 5. è°ƒæ•´ç»†èŠ‚
g.set_titles("{col_name}")  # è®¾ç½®å­å›¾æ ‡é¢˜
g.set_axis_labels("", "Value") # ç§»é™¤Xè½´æ ‡ç­¾ï¼Œè®¾ç½®Yè½´æ ‡ç­¾

# éå†æ¯ä¸ªå­å›¾ï¼ˆæ¯ä¸ª col çš„å­å›¾ï¼‰
for ax, metric in zip(g.axes.flat, y_limits.keys()):
    # è®¾ç½® Y è½´ä½¿ç”¨ä½ æŒ‡å®šçš„ä¸Šé™
    y_upper = y_limits[metric]
    ax.set_ylim(bottom=0, top=y_upper)

# # åœ¨æŸ±å­ä¸Šæ·»åŠ å…·ä½“æ•°å€¼æ ‡ç­¾
# for ax in g.axes.flat:
#     for container in ax.containers:
#         ax.bar_label(container, fmt='%.3f', padding=3, fontsize=9)

plt.subplots_adjust(top=0.85)
g.fig.suptitle('Model Performance Comparison: XGBoost vs RF vs LightGBM vs CatBoost', fontsize=16)

# ä¿å­˜ä¸æ˜¾ç¤º
plt.savefig("model_performance_comparison.png", dpi=300)
plt.show()